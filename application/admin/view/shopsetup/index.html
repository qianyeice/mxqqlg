{extend name="Template/template"/}
{block name="css"}
{/block}
{block name="js"}
{/block}
{block name='body'}
<!--标题-->
<div class="fixed-nav layout">
    <ul>
        <li class="first">站点设置<a id="addHome" title="添加到首页快捷菜单">[+]</a></li>
        <li class="spacer-gray"></li>
        <li class="fixed-nav-tab"><a href="http://api.mxqqlg.com/?s=admin/site/index">站点信息</a></li>
        <li class="fixed-nav-tab"><a href="http://api.mxqqlg.com/?s=admin/basicsetup/index">基本设置</a></li>
        <li class="fixed-nav-tab"><a class="current" href="http://api.mxqqlg.com/?s=admin/shopsetup/index">购物设置</a></li>
        <li class="fixed-nav-tab"><a href="http://api.mxqqlg.com/?s=admin/dreammoneysetup/index">梦想币设置</a></li>
        <li class="fixed-nav-tab"><a href="http://api.mxqqlg.com/?s=admin/integralsetup/index">积分设置</a></li>
        <li class="fixed-nav-tab"><a href="http://api.mxqqlg.com/?s=admin/bonussetup/index">分红设置</a></li>
        <li class="fixed-nav-tab"><a href="http://api.mxqqlg.com/?s=admin/returngoodssetup/index">退货设置</a></li>
        <li class="fixed-nav-tab"><a href="http://api.mxqqlg.com/?s=admin/expresssetup/index">快递设置</a></li>
        <li class="fixed-nav-tab"><a href="http://api.mxqqlg.com/?s=admin/logisticscostsetup/index">物流费用设置</a></li>
    </ul>
    <div class="hr-gray"></div>
</div>
<!--主体-->
<div action="" method="POST" enctype="multipart/form-data">
    <div class="content padding-big have-fixed-nav">
        <div class="content-tabs">
            <div class="form-box clearfix" id="buy">
                <div class="form-group " style="z-index: 5;"><span class="label">支付类型设置：</span>
                    <div class="box">
                        <!--<div class="form-select-edit ">-->
                        <!--<div id="shabi" class="form-buttonedit-popup">-->
                        <!--<input class="input inputon" style="text-indent: 10px;padding: 0px 0px !important;" type="text" value="在线支付 + 货到付款" readonly="readonly">-->
                        <!--<span class="ico_buttonedit"></span>-->
                        <!--<div></div>-->
                        <!--</div>-->
                        <!--<div class="listbox-items" style="display: block;">-->
                        <!--<span class="listbox-item listbox-item-selected" data-val="1">在线支付 + 货到付款</span>-->
                        <!--<span class="listbox-item" data-val="2">仅在线支付</span>-->
                        <!--<span class="listbox-item" data-val="3">仅货到付款</span>-->
                        <!--</div>-->
                        <!--<input class="form-select-name" type="hidden" name="pay_type" value="1">-->
                        <!--</div>-->
                        {if ($sho.paymenttype == 1)}
                        <select name="city" lay-verify="" class="form-select-edit "
                                style="height: 26px; color: #4d4d4d;padding-left: 5px;">
                            <option value="1" selected>在线支付 + 货到付款</option>
                            <option value="2">仅在线支付</option>
                            <option value="0">仅货到付款</option>
                        </select>
                        {elseif $sho.paymenttype == 0 /}
                        <select name="city" lay-verify="" class="form-select-edit "
                                style="height: 26px; color: #4d4d4d;padding-left: 5px;">
                            <option value="1">在线支付 + 货到付款</option>
                            <option value="2">仅在线支付</option>
                            <option value="0" selected>仅货到付款</option>
                        </select>
                        {else /}
                        <select name="city" lay-verify="" class="form-select-edit "
                                style="height: 26px; color: #4d4d4d;padding-left: 5px;">
                            <option value="1">在线支付 + 货到付款</option>
                            <option value="2" selected>仅在线支付</option>
                            <option value="0">仅货到付款</option>
                        </select>
                        {/if}
                    </div>
                    <p class="desc">请选择结算时支持的付款类型，默认为支持"在线支付+货到付款"</p>
                </div>
                <div class="form-group ">
                    <span class="label">请选择支持的支付方式：</span>
                    <div class="box"></div>
                    <p class="desc">设置在线支付时所支持的支付方式，需先在支付平台设置开启支付方式</p>
                </div>
                <div class="form-group " style="z-index: 4;">
                    <span class="label">购物车设置：</span>
                    <div class="box">
                        <!--<div class="form-select-edit ">-->
                        <!--<div class="form-buttonedit-popup">-->
                        <!--<input class="input inputon" type="text" value="跳转到购买成功页面" readonly="readonly">-->
                        <!--<span class="ico_buttonedit"></span>-->
                        <!--</div>-->
                        <!--<div class="listbox-items" style="display: none;">-->
                        <!--<span class="listbox-item listbox-item-selected" data-val="0">跳转到购买成功页面</span>-->
                        <!--<span class="listbox-item" data-val="1">跳转到购物车页面</span>-->
                        <!--<span class="listbox-item" data-val="2">页面不跳转直接加入购物车</span>-->
                        <!--</div>-->
                        <!--<input class="form-select-name" type="hidden" name="cart_jump" value="0">-->
                        <!--</div>-->
                        {if ($sho.shoppingcart == 1)}
                        <select name="city" lay-verify="" class="form-select-edit "
                                style="height: 26px;color: #4d4d4d;padding-left: 5px;">
                            <option value="1" selected>跳转到购买成功页面</option>
                            <option value="2">跳转到购物车页面</option>
                            <option value="0">页面不跳转直接加入购物车</option>
                        </select>
                        {elseif $sho.shoppingcart == 0 /}
                        <select name="city" lay-verify="" class="form-select-edit "
                                style="height: 26px; color: #4d4d4d;padding-left: 5px;">
                            <option value="1">跳转到购买成功页面</option>
                            <option value="2">跳转到购物车页面</option>
                            <option value="0" selected>页面不跳转直接加入购物车</option>
                        </select>
                        {else /}
                        <select name="city" lay-verify="" class="form-select-edit "
                                style="height: 26px; color: #4d4d4d;padding-left: 5px;">
                            <option value="1">跳转到购买成功页面</option>
                            <option value="2" selected>跳转到购物车页面</option>
                            <option value="0">页面不跳转直接加入购物车</option>
                        </select>
                        {/if}
                    </div>
                    <p class="desc">设置“加入购物车”提示。默认：跳转到购买成功页面</p>
                </div>
                <div class="form-group " style="z-index: 3;">
                    <span class="label">库存下降设置：</span>
                    <div class="box">
                        <!--<div class="form-select-edit ">-->
                        <!--<div class="form-buttonedit-popup">-->
                        <!--<input class="input inputon" type="text" value="订单付款时减库存" readonly="readonly">-->
                        <!--<span class="ico_buttonedit"></span>-->
                        <!--</div>-->
                        <!--<div class="listbox-items" style="display: none;">-->
                        <!--<span class="listbox-item" data-val="0">订单下单时减库存</span>-->
                        <!--<span class="listbox-item listbox-item-selected" data-val="1">订单付款时减库存</span>-->
                        <!--<span class="listbox-item" data-val="2">订单发货时减库存</span>-->
                        <!--</div>-->
                        <!--<input class="form-select-name" type="hidden" name="stock_change" value="1">-->
                        <!--</div>-->
                        {if ($sho.kuqaset == 1)}
                        <select name="city" lay-verify="" class="form-select-edit "
                                style="height: 26px; color: #4d4d4d;padding-left: 5px;">
                            <option value="2">订单下单时减库存</option>
                            <option value="1" selected>订单付款时减库存</option>
                            <option value="0">订单发货时减库存</option>
                        </select>
                        {elseif $sho.kuqaset == 0 /}
                        <select name="city" lay-verify="" class="form-select-edit "
                                style="height: 26px; color: #4d4d4d;padding-left: 5px;">
                            <option value="2">订单下单时减库存</option>
                            <option value="1">订单付款时减库存</option>
                            <option value="0" selected>订单发货时减库存</option>
                        </select>
                        {else /}
                        <select name="city" lay-verify="" class="form-select-edit "
                                style="height: 26px; color: #4d4d4d;padding-left: 5px;">
                            <option value="2" selected>订单下单时减库存</option>
                            <option value="1">订单付款时减库存</option>
                            <option value="0">订单发货时减库存</option>
                        </select>
                        {/if}
                    </div>
                    <p class="desc">设置库存下降时机，默认为当用户下单成功时商品库存下降</p>
                </div>
                <div class="form-group ">
                    <span class="label">是否显示购买记录：</span>
                    <div class="box">
                        {if ($sho.orbuy == 1)}
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="invoice_vat_enabled" value="1" checked="">开启
                        </label>
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="invoice_vat_enabled" value="0">关闭
                        </label><br>
                        {else /}
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="invoice_vat_enabled" value="1">开启
                        </label>
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="invoice_vat_enabled" value="0" checked="">关闭
                        </label><br>
                        {/if}
                    </div>
                    <p class="desc">前台商品详情页面是否显示商品购买记录</p>
                </div>
                <div class="form-group ">
                    <span class="label">是否开启余额支付功能：</span>
                    <div class="box">
                        {if ($sho.orsum == 1)}
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="balance_pay" value="1" checked="">开启
                        </label>
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="balance_pay" value="0">关闭
                        </label><br>
                        {else /}
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="balance_pay" value="1">开启
                        </label>
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="balance_pay" value="0" checked="">关闭
                        </label><br>
                        {/if}
                    </div>
                    <p class="desc">是否开启余额支付功能，开启后请指定支持的余额充值支付方式</p>
                </div>
                <div class="form-group ">
                    <span class="label">请选择余额充值的支付方式：</span>
                    <div class="box"></div>
                    <p class="desc">设置余额充值所支持的支付方式，需先在支付平台设置开启支付方式</p>
                </div>
                <div class="form-group ">
                    <span class="label">是否开启发票功能：</span>
                    <div class="box">
                        {if ($sho.orinvoice == 1)}
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="invoice_enabled" value="1" checked="">开启
                        </label>
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="invoice_enabled" value="0">关闭
                        </label><br>
                        {else /}
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="invoice_enabled" value="1">开启
                        </label>
                        <label class="select-wrap">
                            <input class="select-btn" type="radio" name="invoice_enabled" value="0" checked="">关闭
                        </label><br>
                        {/if}
                    </div>
                    <p class="desc">设置是否开启发票功能</p>
                </div>
            </div>
            <div class="form-box clearfix for-invoice">
                <div class="form-group ">
                    <span class="label">发票税率：</span>
                    <div class="box">
                        <input class="input hd-input rate" type="text" name="invoice_tax" value="{$sho.taxinvoice}"
                               tabindex="0">
                    </div>
                    <p class="desc">设置开发票的税率，单位为%</p>
                </div>
                <div class="form-group ">
                    <span class="label">发票内容设置：</span>
                    <div class="box">
                        <textarea class="textarea hd-input" name="invoice_content"
                                  placeholder="">{$sho.invoicecontent}</textarea>
                    </div>
                    <p class="desc">客户要求开发票时可以选择的内容，每一行代表一个选项，例如：办公用品</p>
                </div>
            </div>
        </div>
        <div class="padding">
            <input type="submit" class="button bg-main" value="保存">
        </div>
    </div>
    <input class="hd-input" type="hidden" name="formhash" value="{$sho.id}">
</div>
{/block}
{block name='script'}
<script type="text/javascript">
    $(function () {
        $('div .bg-main').on('click', function () {
            var checked = [];
            for (var y = 0; y < ($(':checked').length); y++) {
                checked[y] = $(':checked').eq(y).val();
            }
            var array = [];
            for (var i = 0; i < $('.hd-input').length; i++) {
                array[i] = $('.hd-input').eq(i).val();
            }
            // 发票税率正则
            var reg = new RegExp("^(\\d|[1-9]\\d|100)$");
            if (!reg.test($('.rate').val())) {
                layer.tips('请输入0-100的整数！', $('.rate'));
                $('.rate').css('border', 'solid 1px red');
            } else {
                $.post('/?s=admin/shopsetup/siteupdata', {checked: checked, array: array}, function (data) {
                    if (data['type'] == '1') {
                        location.href = '/?s=admin/succeed/index&c=shopsetup&a=index'
                    } else {
                        location.href = '/?s=admin/succeed/index&c=shopsetup&a=index&type=1'
                    }
                })
            }
        })
    })
</script>
{/block}